"use client";
import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import { useState } from "react";
import { useRouter } from "next/navigation";
import { Button, GlassPanel, Icon, Input } from "@vayva/ui";
import { CalendarSyncSettings } from "./products/calendar-sync-settings";
export const ProductForm = ({ initialData, isEdit = false, }) => {
    const router = useRouter();
    const [hasVariants, setHasVariants] = useState(false);
    const [options, setOptions] = useState([]);
    const [variants, setVariants] = useState([]);
    const [newOptionName, setNewOptionName] = useState("");
    const [newOptionValues, setNewOptionValues] = useState("");
    const handleAddOption = () => {
        if (!newOptionName || !newOptionValues)
            return;
        const values = newOptionValues.split(",").map(v => v.trim()).filter(Boolean);
        const newOptions = [...options, { name: newOptionName, values }];
        setOptions(newOptions);
        setNewOptionName("");
        setNewOptionValues("");
        generateVariants(newOptions);
    };
    const removeOption = (idx) => {
        const newOptions = [...options];
        newOptions.splice(idx, 1);
        setOptions(newOptions);
        generateVariants(newOptions);
    };
    const generateVariants = (opts) => {
        if (opts.length === 0) {
            setVariants([]);
            return;
        }
        // Cartesian Product
        const cartesian = (sets) => {
            return sets.reduce((acc, set) => {
                return acc.flatMap(x => set.map(y => [...x, y]));
            }, [[]]);
        };
        const combinations = cartesian(opts.map(o => o.values));
        const newVariants = combinations.map(combo => ({
            name: combo.join(" / "),
            price: initialData?.price,
            inventory: 0,
            sku: ""
        }));
        setVariants(newVariants);
    };
    const updateVariant = (idx, field, value) => {
        const updated = [...variants];
        updated[idx] = { ...updated[idx], [field]: value };
        setVariants(updated);
    };
    // Test save
    const handleSave = () => {
        // Logic would go here
        router.push("/dashboard/products");
    };
    return (_jsxs("div", { className: "flex flex-col gap-6 max-w-6xl mx-auto pb-20", children: [_jsxs("div", { className: "flex items-center justify-between sticky top-[80px] z-30 py-4 bg-[#142210]/95 backdrop-blur-xl border-b border-white/5 -mx-6 px-6 sm:mx-0 sm:px-0 sm:bg-transparent sm:border-none sm:backdrop-blur-none sm:static", children: [_jsxs("div", { className: "flex flex-col", children: [_jsx("h1", { className: "text-2xl font-bold text-white", children: isEdit ? "Edit Product" : "Add Product" }), isEdit && (_jsx("p", { className: "text-text-secondary text-sm", children: "Last saved a few minutes ago" }))] }), _jsxs("div", { className: "flex gap-2", children: [_jsx(Button, { variant: "ghost", onClick: () => router.back(), children: "Discard" }), _jsx(Button, { onClick: handleSave, children: isEdit ? "Save Changes" : "Save Product" })] })] }), _jsxs("div", { className: "grid grid-cols-1 lg:grid-cols-3 gap-6", children: [_jsxs("div", { className: "lg:col-span-2 flex flex-col gap-6", children: [_jsxs(GlassPanel, { className: "p-6", children: [_jsx("h3", { className: "font-bold text-white mb-4", children: "Media" }), _jsxs("div", { className: "border border-dashed border-white/20 rounded-xl p-8 flex flex-col items-center justify-center text-center hover:bg-white/5 transition-colors cursor-pointer", children: [_jsx(Icon, { name: "ImagePlus", size: 32, className: "text-text-secondary mb-2" }), _jsx("p", { className: "text-sm font-bold text-white", children: "Add images" }), _jsx("p", { className: "text-xs text-text-secondary", children: "Drag and drop or click to upload" })] })] }), _jsxs(GlassPanel, { className: "p-6", children: [_jsx("h3", { className: "font-bold text-white mb-4", children: "Basic Info" }), _jsxs("div", { className: "flex flex-col gap-4", children: [_jsxs("div", { children: [_jsx("label", { className: "text-xs text-text-secondary uppercase font-bold tracking-wider mb-2 block", children: "Product Name" }), _jsx(Input, { id: "product-name", "aria-label": "Product Name", defaultValue: initialData?.name, placeholder: "e.g. Nike Air Max 90" })] }), _jsxs("div", { children: [_jsx("label", { className: "text-xs text-text-secondary uppercase font-bold tracking-wider mb-2 block", children: "Description" }), _jsx("textarea", { className: "w-full bg-white/5 border border-white/10 rounded-xl p-3 text-sm text-white resize-none focus:outline-none focus:border-primary transition-colors min-h-[120px]", defaultValue: initialData?.description, placeholder: "Describe your product...", "aria-label": "Description" })] })] })] }), _jsxs(GlassPanel, { className: "p-6", children: [_jsxs("div", { className: "flex items-center justify-between", children: [_jsxs("div", { children: [_jsx("h3", { className: "font-bold text-white", children: "Variants" }), _jsx("p", { className: "text-sm text-text-secondary", children: "Does this product have options like size or color?" })] }), _jsx("input", { id: "variant-toggle", type: "checkbox", className: "toggle toggle-primary", checked: hasVariants, onChange: (e) => setHasVariants(e.target.checked), "aria-label": "Enable variants" })] }), hasVariants && (_jsxs("div", { className: "mt-6 pt-6 border-t border-white/5 space-y-6", children: [_jsxs("div", { className: "space-y-4", children: [options.map((opt, idx) => (_jsxs("div", { className: "bg-white/5 p-4 rounded-xl border border-white/10", children: [_jsxs("div", { className: "flex justify-between mb-2", children: [_jsx("span", { className: "font-bold text-white", children: opt.name }), _jsx(Button, { variant: "link", onClick: () => removeOption(idx), className: "text-xs text-red-400 hover:text-red-300 h-auto p-0", children: "Remove" })] }), _jsx("div", { className: "flex flex-wrap gap-2", children: opt.values.map((val, vIdx) => (_jsx("span", { className: "bg-white/10 px-2 py-1 rounded text-xs text-white border border-white/10", children: val }, vIdx))) })] }, idx))), _jsxs("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-4", children: [_jsxs("div", { children: [_jsx("label", { className: "text-xs text-text-secondary uppercase font-bold tracking-wider mb-2 block", children: "Option Name" }), _jsx(Input, { placeholder: "e.g. Size", value: newOptionName, onChange: (e) => setNewOptionName(e.target.value), "aria-label": "New Option Name" })] }), _jsxs("div", { children: [_jsx("label", { className: "text-xs text-text-secondary uppercase font-bold tracking-wider mb-2 block", children: "Option Values" }), _jsxs("div", { className: "flex gap-2", children: [_jsx(Input, { placeholder: "e.g. Small, Medium (comma separated)", value: newOptionValues, onChange: (e) => setNewOptionValues(e.target.value), onKeyDown: (e) => {
                                                                                    if (e.key === 'Enter') {
                                                                                        e.preventDefault();
                                                                                        handleAddOption();
                                                                                    }
                                                                                }, "aria-label": "New Option Values" }), _jsx(Button, { onClick: handleAddOption, disabled: !newOptionName || !newOptionValues, children: "Add" })] })] })] })] }), variants.length > 0 && (_jsx("div", { className: "overflow-x-auto rounded-xl border border-white/10", children: _jsxs("table", { className: "w-full text-left text-sm text-white", children: [_jsx("thead", { className: "bg-white/5 uppercase text-xs text-text-secondary font-bold", children: _jsxs("tr", { children: [_jsx("th", { className: "p-3", children: "Variant" }), _jsx("th", { className: "p-3", children: "Price" }), _jsx("th", { className: "p-3", children: "Stock" }), _jsx("th", { className: "p-3", children: "SKU" })] }) }), _jsx("tbody", { className: "divide-y divide-white/5", children: variants.map((variant, idx) => (_jsxs("tr", { className: "hover:bg-white/5 transition-colors", children: [_jsx("td", { className: "p-3 font-medium", children: variant.name }), _jsx("td", { className: "p-3", children: _jsx(Input, { className: "h-8 w-24 text-right font-mono", defaultValue: initialData?.price || 0, onChange: (e) => updateVariant(idx, 'price', e.target.value), "aria-label": `Price for ${variant.name}` }) }), _jsx("td", { className: "p-3", children: _jsx(Input, { className: "h-8 w-20 text-right font-mono", defaultValue: 0, onChange: (e) => updateVariant(idx, 'inventory', e.target.value), "aria-label": `Stock for ${variant.name}` }) }), _jsx("td", { className: "p-3", children: _jsx(Input, { className: "h-8 w-32 font-mono text-xs", placeholder: "SKU", onChange: (e) => updateVariant(idx, 'sku', e.target.value), "aria-label": `SKU for ${variant.name}` }) })] }, idx))) })] }) }))] }))] })] }), _jsxs("div", { className: "flex flex-col gap-6", children: [_jsxs(GlassPanel, { className: "p-6", children: [_jsx("h3", { className: "font-bold text-white mb-4", children: "Status" }), _jsxs("div", { className: "form-control", children: [_jsxs("label", { className: "label cursor-pointer justify-start gap-4", children: [_jsx("input", { type: "radio", name: "status", id: "status-active", className: "radio radio-primary", defaultChecked: initialData?.status === "active", "aria-label": "Set status to Active" }), _jsx("span", { className: "label-text text-white", children: "Active" })] }), _jsxs("label", { className: "label cursor-pointer justify-start gap-4", children: [_jsx("input", { type: "radio", name: "status", id: "status-draft", className: "radio radio-primary", defaultChecked: initialData?.status !== "active", "aria-label": "Set status to Draft" }), _jsx("span", { className: "label-text text-white", children: "Draft" })] })] })] }), _jsxs(GlassPanel, { className: "p-6", children: [_jsx("h3", { className: "font-bold text-white mb-4", children: "Pricing" }), _jsxs("div", { className: "flex flex-col gap-4", children: [_jsxs("div", { children: [_jsx("label", { className: "text-xs text-text-secondary uppercase font-bold tracking-wider mb-2 block", children: "Price (\u20A6)" }), _jsx(Input, { defaultValue: initialData?.price, placeholder: "0.00", className: "font-mono text-lg", "aria-label": "Price" })] }), _jsxs("div", { className: "grid grid-cols-2 gap-4", children: [_jsxs("div", { children: [_jsx("label", { className: "text-xs text-text-secondary uppercase font-bold tracking-wider mb-2 block", children: "Cost" }), _jsx(Input, { placeholder: "0.00", "aria-label": "Cost" })] }), _jsxs("div", { children: [_jsx("label", { className: "text-xs text-text-secondary uppercase font-bold tracking-wider mb-2 block", children: "Profit" }), _jsx("div", { className: "h-12 flex items-center px-4 text-text-secondary text-sm border border-transparent", children: "--" })] })] })] })] }), _jsxs(GlassPanel, { className: "p-6", children: [_jsx("h3", { className: "font-bold text-white mb-4", children: "Inventory" }), _jsxs("div", { className: "flex flex-col gap-4", children: [_jsxs("div", { children: [_jsx("label", { className: "text-xs text-text-secondary uppercase font-bold tracking-wider mb-2 block", children: "SKU (Optional)" }), _jsx(Input, { defaultValue: initialData?.sku, "aria-label": "SKU" })] }), _jsxs("div", { className: "flex items-center justify-between", children: [_jsx("span", { className: "text-white text-sm", children: "Track quantity" }), _jsx("input", { type: "checkbox", className: "toggle toggle-sm toggle-primary", defaultChecked: true, "aria-label": "Track quantity" })] }), _jsxs("div", { children: [_jsx("label", { className: "text-xs text-text-secondary uppercase font-bold tracking-wider mb-2 block", children: "Available Quantity" }), _jsx(Input, { type: "number", defaultValue: initialData?.inventory || 0, "aria-label": "Available Quantity" })] })] })] }), _jsxs(GlassPanel, { className: "p-6", children: [_jsx("h3", { className: "font-bold text-white mb-4", children: "Organization" }), _jsxs("div", { className: "flex flex-col gap-4", children: [_jsxs("div", { children: [_jsx("label", { className: "text-xs text-text-secondary uppercase font-bold tracking-wider mb-2 block", children: "Category" }), _jsxs("select", { className: "h-12 w-full rounded-full bg-white/5 border border-white/10 px-4 text-white outline-none focus:border-primary", "aria-label": "Category", children: [_jsx("option", { children: "Select..." }), _jsx("option", { children: "Apparel" }), _jsx("option", { children: "Accessories" })] })] }), _jsxs("div", { children: [_jsx("label", { className: "text-xs text-text-secondary uppercase font-bold tracking-wider mb-2 block", children: "Collections" }), _jsx(Input, { placeholder: "Search collections...", "aria-label": "Collections" })] })] })] }), isEdit && initialData?.id && (_jsxs(GlassPanel, { className: "p-6", children: [_jsx("h3", { className: "font-bold text-white mb-4", children: "Availability Sync" }), _jsx("p", { className: "text-xs text-text-secondary mb-4", children: "Connect external calendars (Airbnb, Booking.com) to prevent double bookings." }), _jsx(CalendarSyncSettings, { productId: initialData.id, initialSyncs: initialData.calendarSyncs })] }))] })] })] }));
};
