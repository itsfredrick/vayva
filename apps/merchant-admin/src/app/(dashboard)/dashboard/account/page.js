"use client";
import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import useSWR from "swr";
import Link from "next/link";
import { format } from "date-fns";
import { Shield, CreditCard, User, HelpCircle, LogOut, ExternalLink, AlertTriangle, LayoutTemplate, MessageSquare, ChevronRight, Mail } from "lucide-react";
import { Button } from "@vayva/ui";
import { Card, CardContent, CardDescription, CardHeader, CardTitle, CardFooter } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { Skeleton } from "@/components/ui/skeleton";
import { toast } from "sonner";
import { signOut } from "next-auth/react";
const fetcher = (url) => fetch(url).then((r) => r.json());
export default function AccountOverviewPage() {
    const { data, error, isLoading } = useSWR("/api/account/overview", fetcher);
    const handleSignOutAll = async () => {
        if (!confirm("This will sign you out of all devices immediately. Continue?"))
            return;
        try {
            const res = await fetch("/api/auth/security/signout-all", { method: "POST" });
            if (!res.ok)
                throw new Error("Failed");
            toast.success("Signed out of all devices");
            signOut({ callbackUrl: "/login" });
        }
        catch (err) {
            toast.error("Failed to sign out all devices");
        }
    };
    if (isLoading)
        return _jsx(AccountSkeleton, {});
    if (error)
        return _jsx("div", { className: "p-8 text-red-500", children: "Failed to load account data." });
    if (!data)
        return null;
    const { profile, subscription, kyc, payouts, security, integrations } = data;
    return (_jsxs("div", { className: "space-y-6 max-w-6xl mx-auto p-6", children: [_jsxs("header", { className: "flex flex-col md:flex-row md:items-center md:justify-between gap-4", children: [_jsxs("div", { children: [_jsx("h1", { className: "text-3xl font-bold tracking-tight", children: "Account Overview" }), _jsx("p", { className: "text-muted-foreground", children: "Manage your store identity, security settings, and subscriptions." })] }), _jsxs("div", { className: "flex gap-2", children: [_jsx(Link, { href: "/dashboard/control-center", children: _jsxs(Button, { variant: "outline", children: [_jsx(LayoutTemplate, { className: "mr-2 h-4 w-4" }), "Storefront"] }) }), _jsx(Link, { href: "/dashboard/settings/whatsapp", children: _jsxs(Button, { variant: "primary", className: "bg-green-600 hover:bg-green-700", children: [_jsx(MessageSquare, { className: "mr-2 h-4 w-4" }), "WhatsApp"] }) })] })] }), _jsxs("div", { className: "grid gap-6 md:grid-cols-2", children: [_jsxs(Card, { children: [_jsxs(CardHeader, { children: [_jsxs(CardTitle, { className: "flex items-center gap-2", children: [_jsx(User, { className: "h-5 w-5 text-blue-500" }), "Identity & Store"] }), _jsx(CardDescription, { children: "Your store profile and verification status." })] }), _jsxs(CardContent, { className: "space-y-4", children: [_jsxs("div", { className: "flex justify-between items-center py-2 border-b", children: [_jsx("span", { className: "text-sm font-medium", children: "Store Name" }), _jsx("span", { className: "text-sm text-muted-foreground", children: profile.name })] }), _jsxs("div", { className: "flex justify-between items-center py-2 border-b", children: [_jsx("span", { className: "text-sm font-medium", children: "Category" }), _jsx("span", { className: "text-sm text-muted-foreground", children: profile.category })] }), _jsxs("div", { className: "flex justify-between items-center py-2 border-b", children: [_jsx("span", { className: "text-sm font-medium", children: "Identity Verification (KYC)" }), kyc.status === "VERIFIED" ? (_jsx(Badge, { className: "bg-green-100 text-green-700 hover:bg-green-200 border-green-200", children: "Verified" })) : (_jsx(Link, { href: "/dashboard/settings/kyc", children: _jsxs(Badge, { variant: "outline", className: "cursor-pointer hover:bg-muted", children: [kyc.status === "PENDING" ? "In Review" : "Complete Now", " ", _jsx(ChevronRight, { className: "h-3 w-3 ml-1" })] }) }))] }), _jsxs("div", { className: "flex justify-between items-center py-2", children: [_jsx("span", { className: "text-sm font-medium", children: "Status" }), _jsx(Badge, { variant: profile.isLive ? "default" : "secondary", children: profile.isLive ? "Live" : "Draft" })] })] }), _jsx(CardFooter, { children: _jsx(Link, { href: "/dashboard/settings/profile", className: "w-full", children: _jsx(Button, { variant: "outline", className: "w-full", children: "Edit Profile" }) }) })] }), _jsxs(Card, { children: [_jsxs(CardHeader, { children: [_jsxs(CardTitle, { className: "flex items-center gap-2", children: [_jsx(Shield, { className: "h-5 w-5 text-amber-500" }), "Security"] }), _jsx(CardDescription, { children: "Protect your account and sessions." })] }), _jsxs(CardContent, { className: "space-y-4", children: [_jsxs("div", { className: "flex justify-between items-center py-2 border-b", children: [_jsx("span", { className: "text-sm font-medium", children: "Multi-Factor Auth (MFA)" }), security.mfaEnabled ? (_jsx(Badge, { className: "bg-green-500", children: "Enabled" })) : (_jsx(Link, { href: "/dashboard/settings/security", children: _jsx(Button, { variant: "link", size: "sm", className: "h-auto p-0", children: "Enable MFA" }) }))] }), _jsxs("div", { className: "flex justify-between items-center py-2 border-b", children: [_jsx("span", { className: "text-sm font-medium", children: "Password" }), _jsx(Link, { href: "/dashboard/settings/security", children: _jsx(Button, { variant: "link", size: "sm", className: "h-auto p-0", children: "Change Password" }) })] }), _jsxs("div", { className: "flex justify-between items-center py-2", children: [_jsx("span", { className: "text-sm font-medium", children: "Active Sessions" }), _jsxs("span", { className: "text-sm font-mono bg-muted px-2 py-1 rounded", children: ["~ ", security.recentLogins, " detected"] })] })] }), _jsx(CardFooter, { children: _jsxs(Button, { variant: "outline", className: "w-full text-red-600 hover:text-red-700 hover:bg-red-50 border-red-200", onClick: handleSignOutAll, children: [_jsx(LogOut, { className: "mr-2 h-4 w-4" }), "Sign Out All Devices"] }) })] }), _jsxs(Card, { children: [_jsxs(CardHeader, { children: [_jsxs(CardTitle, { className: "flex items-center gap-2", children: [_jsx(CreditCard, { className: "h-5 w-5 text-purple-500" }), "Billing & Payouts"] }), _jsx(CardDescription, { children: "Plan management and bank account." })] }), _jsxs(CardContent, { className: "space-y-4", children: [_jsxs("div", { className: "flex justify-between items-center py-2 border-b", children: [_jsx("span", { className: "text-sm font-medium", children: "Current Plan" }), _jsx(Badge, { variant: "secondary", className: "uppercase", children: subscription.plan })] }), subscription.renewalDate && (_jsxs("div", { className: "flex justify-between items-center py-2 border-b", children: [_jsx("span", { className: "text-sm font-medium", children: "Renews On" }), _jsx("span", { className: "text-sm text-muted-foreground", children: format(new Date(subscription.renewalDate), "MMM d, yyyy") })] })), _jsxs("div", { className: "flex justify-between items-center py-2", children: [_jsx("span", { className: "text-sm font-medium", children: "Payout Account" }), payouts.bankConnected ? (_jsx("span", { className: "text-sm font-mono", children: payouts.maskedAccount })) : (_jsxs("span", { className: "text-sm text-red-500 flex items-center gap-1", children: [_jsx(AlertTriangle, { className: "h-3 w-3" }), " Missing"] }))] })] }), _jsx(CardFooter, { children: _jsx(Link, { href: "/dashboard/billing", className: "w-full", children: _jsx(Button, { variant: "outline", className: "w-full", children: "Manage Billing" }) }) })] }), _jsxs(Card, { children: [_jsxs(CardHeader, { children: [_jsxs(CardTitle, { className: "flex items-center gap-2", children: [_jsx(HelpCircle, { className: "h-5 w-5 text-teal-500" }), "Support & Help"] }), _jsx(CardDescription, { children: "Get help when you need it." })] }), _jsxs(CardContent, { className: "space-y-4", children: [_jsxs(Link, { href: "https://help.vayva.ng", target: "_blank", className: "flex items-center justify-between p-3 border rounded-lg hover:bg-muted transition-colors", children: [_jsxs("div", { className: "flex items-center gap-3", children: [_jsx("div", { className: "p-2 bg-blue-50 text-blue-600 rounded-full", children: _jsx(HelpCircle, { className: "h-4 w-4" }) }), _jsxs("div", { children: [_jsx("div", { className: "text-sm font-medium", children: "Knowledge Base" }), _jsx("div", { className: "text-xs text-muted-foreground", children: "Guides and FAQs" })] })] }), _jsx(ExternalLink, { className: "h-4 w-4 text-muted-foreground" })] }), _jsxs(Link, { href: "/dashboard/support/tickets/new", className: "flex items-center justify-between p-3 border rounded-lg hover:bg-muted transition-colors", children: [_jsxs("div", { className: "flex items-center gap-3", children: [_jsx("div", { className: "p-2 bg-purple-50 text-purple-600 rounded-full", children: _jsx(Mail, { className: "h-4 w-4" }) }), _jsxs("div", { children: [_jsx("div", { className: "text-sm font-medium", children: "Contact Support" }), _jsx("div", { className: "text-xs text-muted-foreground", children: "Open a ticket" })] })] }), _jsx(ChevronRight, { className: "h-4 w-4 text-muted-foreground" })] })] })] })] })] }));
}
function AccountSkeleton() {
    return (_jsxs("div", { className: "space-y-6 max-w-6xl mx-auto p-6", children: [_jsxs("div", { className: "flex justify-between", children: [_jsxs("div", { className: "space-y-2", children: [_jsx(Skeleton, { className: "h-8 w-48" }), _jsx(Skeleton, { className: "h-4 w-64" })] }), _jsx(Skeleton, { className: "h-10 w-32" })] }), _jsx("div", { className: "grid gap-6 md:grid-cols-2", children: [1, 2, 3, 4].map((i) => (_jsx(Skeleton, { className: "h-64 w-full" }, i))) })] }));
}
