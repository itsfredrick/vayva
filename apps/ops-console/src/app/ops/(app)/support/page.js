"use client";
import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import { useState } from "react";
import { useRouter } from "next/navigation";
import { LifeBuoy } from "lucide-react";
import { useOpsQuery } from "@/hooks/useOpsQuery";
import { Button } from "@vayva/ui";
export default function SupportPage() {
    const router = useRouter();
    const [filter, setFilter] = useState("OPEN");
    const { data: tickets, isLoading } = useOpsQuery(["support-tickets", filter], () => fetch(`/api/ops/support?status=${filter.toLowerCase()}`).then(res => res.json().then(j => j.data)));
    const { data: stats } = useOpsQuery(["support-stats"], () => fetch("/api/ops/support/stats").then(res => res.json()));
    const getStatusBadge = (status) => {
        const s = status.toUpperCase();
        switch (s) {
            case "OPEN": return _jsx("span", { className: "px-2 py-0.5 rounded text-xs font-bold bg-blue-100 text-blue-700", children: "Open" });
            case "RESOLVED": return _jsx("span", { className: "px-2 py-0.5 rounded text-xs font-bold bg-green-100 text-green-700", children: "Resolved" });
            case "CLOSED": return _jsx("span", { className: "px-2 py-0.5 rounded text-xs font-bold bg-gray-100 text-gray-600", children: "Closed" });
            default: return _jsx("span", { className: "px-2 py-0.5 rounded text-xs font-bold bg-gray-100 text-gray-600", children: status });
        }
    };
    return (_jsxs("div", { className: "p-8 space-y-6", children: [_jsxs("div", { className: "flex justify-between items-center", children: [_jsxs("div", { children: [_jsxs("h1", { className: "text-3xl font-bold text-gray-900 flex items-center gap-3", children: [_jsx(LifeBuoy, { className: "w-8 h-8 text-indigo-600" }), "Support Knowledge Hub"] }), _jsx("p", { className: "text-gray-500 mt-1", children: "Manage inbound merchant requests and tickets." })] }), _jsx("div", { className: "flex gap-2", children: _jsx(Button, { variant: "primary", className: "px-4 py-2 bg-indigo-600 text-white rounded-lg text-sm font-medium hover:bg-indigo-700 transition-colors h-auto", "aria-label": "Create new support ticket", children: "Create Ticket" }) })] }), _jsxs("div", { className: "grid grid-cols-1 md:grid-cols-3 gap-4", children: [_jsxs("div", { className: "bg-white p-4 rounded-xl border border-gray-200", children: [_jsx("div", { className: "text-gray-500 text-xs font-medium uppercase mb-1", children: "Total Tickets" }), _jsx("div", { className: "text-2xl font-bold", children: stats?.total || 0 })] }), _jsxs("div", { className: "bg-white p-4 rounded-xl border border-gray-200", children: [_jsx("div", { className: "text-blue-600 text-xs font-medium uppercase mb-1", children: "Open" }), _jsx("div", { className: "text-2xl font-bold", children: stats?.open || 0 })] }), _jsxs("div", { className: "bg-white p-4 rounded-xl border border-gray-200", children: [_jsx("div", { className: "text-green-600 text-xs font-medium uppercase mb-1", children: "Resolved" }), _jsx("div", { className: "text-2xl font-bold", children: stats?.resolved || 0 })] })] }), _jsx("div", { className: "flex items-center gap-4 border-b border-gray-200 pb-1", children: ["OPEN", "RESOLVED", "ALL"].map(s => (_jsxs(Button, { variant: "ghost", onClick: () => setFilter(s), className: `px-4 py-3 text-sm font-medium border-b-2 rounded-none transition-colors -mb-1.5 h-auto hover:bg-transparent ${filter === s ? "border-indigo-600 text-indigo-600" : "border-transparent text-gray-500 hover:text-gray-700"}`, "aria-label": `Filter by ${s} status`, children: [s, " Tickets"] }, s))) }), _jsx("div", { className: "bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden", children: _jsxs("table", { className: "w-full text-left text-sm", children: [_jsx("thead", { className: "bg-gray-50 text-gray-500 border-b border-gray-100", children: _jsxs("tr", { children: [_jsx("th", { className: "px-6 py-3 font-medium", children: "Ticket ID" }), _jsx("th", { className: "px-6 py-3 font-medium", children: "Subject" }), _jsx("th", { className: "px-6 py-3 font-medium", children: "Merchant" }), _jsx("th", { className: "px-6 py-3 font-medium", children: "Status" }), _jsx("th", { className: "px-6 py-3 font-medium", children: "Created" })] }) }), _jsx("tbody", { className: "divide-y divide-gray-100", children: isLoading ? (_jsx("tr", { children: _jsx("td", { colSpan: 5, className: "p-12 text-center text-gray-400", children: "Loading tickets..." }) })) : !tickets?.length ? (_jsx("tr", { children: _jsx("td", { colSpan: 5, className: "p-12 text-center text-gray-400", children: "No tickets found." }) })) : (tickets.map((t) => (_jsxs("tr", { onClick: () => router.push(`/ops/support/${t.id}`), className: "hover:bg-gray-50 cursor-pointer transition-colors", children: [_jsxs("td", { className: "px-6 py-4 font-mono text-xs text-gray-500", children: ["#", t.id.slice(0, 8)] }), _jsx("td", { className: "px-6 py-4 font-medium text-gray-900", children: t.summary }), _jsx("td", { className: "px-6 py-4", children: _jsxs("div", { className: "flex items-center gap-2", children: [t.store?.logoUrl ? (_jsx("img", { src: t.store.logoUrl, alt: t.store?.name || "Store logo", className: "w-5 h-5 rounded-full bg-gray-100" })) : (_jsx("div", { className: "w-5 h-5 rounded-full bg-indigo-100 text-indigo-600 text-[10px] flex items-center justify-center font-bold", children: t.store?.name?.[0] || "?" })), _jsx("span", { className: "text-gray-700", children: t.store?.name || "Unknown" })] }) }), _jsx("td", { className: "px-6 py-4", children: getStatusBadge(t.status) }), _jsx("td", { className: "px-6 py-4 text-gray-500", children: new Date(t.createdAt).toLocaleDateString() })] }, t.id)))) })] }) })] }));
}
