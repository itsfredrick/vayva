"use client";
import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import { useState } from "react";
import { Users, Filter, Calculator, Send } from "lucide-react";
import { useOpsQuery } from "@/hooks/useOpsQuery";
import { Button } from "@vayva/ui";
export default function SegmentsPage() {
    const [minSpend, setMinSpend] = useState(0);
    const [minOrders, setMinOrders] = useState(0);
    const { data: customers, isLoading, refetch } = useOpsQuery(["audience-segments", String(minSpend), String(minOrders)], () => fetch(`/api/ops/communications/segments?minSpend=${minSpend}&minOrders=${minOrders}`).then(res => res.json().then(j => j.data)));
    return (_jsxs("div", { className: "p-8 space-y-6", children: [_jsx("div", { className: "flex justify-between items-center", children: _jsxs("div", { children: [_jsxs("h1", { className: "text-3xl font-bold text-gray-900 flex items-center gap-3", children: [_jsx(Users, { className: "w-8 h-8 text-indigo-600" }), "Audience Segment Builder"] }), _jsx("p", { className: "text-gray-500 mt-1", children: "Filter platform-wide customers for targeted campaigns." })] }) }), _jsxs("div", { className: "bg-white p-6 rounded-xl border border-gray-200 shadow-sm grid grid-cols-1 md:grid-cols-3 gap-6", children: [_jsxs("div", { children: [_jsxs("label", { className: "block text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2", children: [_jsx(Calculator, { size: 16 }), " Minimum Spend (NGN)"] }), _jsx("input", { type: "number", value: minSpend, onChange: (e) => setMinSpend(Number(e.target.value)), className: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 transition-all", placeholder: "e.g. 5000" })] }), _jsxs("div", { children: [_jsxs("label", { className: "block text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2", children: [_jsx(Filter, { size: 16 }), " Minimum Orders"] }), _jsx("input", { type: "number", value: minOrders, onChange: (e) => setMinOrders(Number(e.target.value)), className: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 transition-all", placeholder: "e.g. 5" })] }), _jsx("div", { className: "flex items-end", children: _jsx(Button, { onClick: () => refetch(), className: "w-full bg-indigo-600 text-white font-bold py-2 rounded-lg hover:bg-indigo-700 transition-colors shadow-md active:scale-95 h-auto text-base", children: "Preview Audience" }) })] }), _jsxs("div", { className: "bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden", children: [_jsxs("div", { className: "px-6 py-4 border-b border-gray-100 flex justify-between items-center bg-gray-50/50", children: [_jsxs("h3", { className: "font-bold text-gray-900", children: ["Audience Preview (", customers?.length || 0, " matches)"] }), customers?.length > 0 && (_jsxs(Button, { variant: "ghost", className: "flex items-center gap-2 text-sm font-bold text-indigo-600 hover:text-indigo-800 p-0 h-auto hover:bg-transparent", children: [_jsx(Send, { size: 14 }), " Create Campaign for this Segment"] }))] }), _jsxs("table", { className: "w-full text-left text-sm", children: [_jsx("thead", { className: "bg-gray-50 text-gray-500 border-b border-gray-100", children: _jsxs("tr", { children: [_jsx("th", { className: "px-6 py-3 font-medium", children: "Customer" }), _jsx("th", { className: "px-6 py-3 font-medium", children: "Email/Phone" }), _jsx("th", { className: "px-6 py-3 font-medium", children: "Order Count" }), _jsx("th", { className: "px-6 py-3 font-medium", children: "Total Spent" }), _jsx("th", { className: "px-6 py-3 font-medium", children: "Joined" })] }) }), _jsx("tbody", { className: "divide-y divide-gray-100", children: isLoading ? (_jsx("tr", { children: _jsx("td", { colSpan: 5, className: "p-12 text-center text-gray-400 font-medium", children: "Analyzing segments..." }) })) : !customers?.length ? (_jsx("tr", { children: _jsx("td", { colSpan: 5, className: "p-12 text-center text-gray-400 font-medium", children: "No customers match these criteria." }) })) : (customers.map((c) => (_jsxs("tr", { className: "hover:bg-indigo-50/30 transition-colors", children: [_jsxs("td", { className: "px-6 py-4 font-bold text-gray-900", children: [c.firstName, " ", c.lastName] }), _jsx("td", { className: "px-6 py-4 text-gray-500", children: c.email || c.phone }), _jsx("td", { className: "px-6 py-4 font-black", children: c.orderCount }), _jsxs("td", { className: "px-6 py-4 font-black text-indigo-700", children: ["\u20A6", Number(c.totalSpend).toLocaleString()] }), _jsx("td", { className: "px-6 py-4 text-gray-500", children: new Date(c.createdAt).toLocaleDateString() })] }, c.id)))) })] })] })] }));
}
