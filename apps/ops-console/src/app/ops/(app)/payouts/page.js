"use client";
import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import { useState } from "react";
import { useRouter } from "next/navigation";
import { ArrowUpRight, CheckCircle, Clock, AlertTriangle, RefreshCw, XCircle } from "lucide-react";
import { useOpsQuery } from "@/hooks/useOpsQuery";
import { Button } from "@vayva/ui";
export default function PayoutsPage() {
    const router = useRouter();
    const [filter, setFilter] = useState("PENDING");
    const { data: withdrawals, isLoading, refetch } = useOpsQuery(["payouts-list", filter], () => fetch(`/api/ops/financials/payouts?status=${filter}`).then(res => res.json().then(j => j.data)));
    const formatCurrency = (kobo) => {
        const amount = parseInt(kobo) / 100;
        return new Intl.NumberFormat('en-NG', { style: 'currency', currency: 'NGN' }).format(amount);
    };
    const getStatusBadge = (status) => {
        switch (status) {
            case "PENDING": return _jsxs("span", { className: "bg-yellow-100 text-yellow-800 px-2 py-0.5 rounded text-xs font-bold flex items-center gap-1", children: [_jsx(Clock, { className: "w-3 h-3" }), " Pending"] });
            case "PROCESSED": return _jsxs("span", { className: "bg-green-100 text-green-700 px-2 py-0.5 rounded text-xs font-bold flex items-center gap-1", children: [_jsx(CheckCircle, { className: "w-3 h-3" }), " Processed"] });
            case "FAILED": return _jsxs("span", { className: "bg-red-100 text-red-700 px-2 py-0.5 rounded text-xs font-bold flex items-center gap-1", children: [_jsx(XCircle, { className: "w-3 h-3" }), " Failed"] });
            default: return _jsx("span", { className: "bg-gray-100 text-gray-600 px-2 py-0.5 rounded text-xs font-bold", children: status });
        }
    };
    return (_jsxs("div", { className: "p-8 space-y-6", children: [_jsxs("div", { className: "flex justify-between items-center", children: [_jsxs("div", { children: [_jsxs("h1", { className: "text-3xl font-bold text-gray-900 flex items-center gap-3", children: [_jsx(ArrowUpRight, { className: "w-8 h-8 text-indigo-600" }), "Payouts Operation Center"] }), _jsx("p", { className: "text-gray-500 mt-1", children: "Audit and process merchant withdrawal requests." })] }), _jsx(Button, { variant: "ghost", size: "icon", onClick: () => refetch(), className: "rounded-full h-8 w-8 text-gray-500 hover:bg-gray-100", "aria-label": "Refresh payouts list", children: _jsx(RefreshCw, { className: `w-5 h-5 ${isLoading ? 'animate-spin' : ''}` }) })] }), _jsx("div", { className: "flex items-center gap-4 border-b border-gray-200 pb-1", children: ["PENDING", "PROCESSED", "FAILED", "ALL"].map(s => (_jsx(Button, { variant: "ghost", onClick: () => setFilter(s), className: `px-4 py-3 text-sm font-medium border-b-2 rounded-none transition-colors -mb-1.5 h-auto hover:bg-transparent ${filter === s ? "border-indigo-600 text-indigo-600" : "border-transparent text-gray-500 hover:text-gray-700"}`, "aria-label": `Filter by ${s} status`, children: s }, s))) }), _jsx("div", { className: "bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden", children: _jsxs("table", { className: "w-full text-left text-sm", children: [_jsx("thead", { className: "bg-gray-50 text-gray-500 border-b border-gray-100", children: _jsxs("tr", { children: [_jsx("th", { className: "px-6 py-4 font-medium", children: "Reference" }), _jsx("th", { className: "px-6 py-4 font-medium", children: "Merchant" }), _jsx("th", { className: "px-6 py-4 font-medium", children: "Amount (Net)" }), _jsx("th", { className: "px-6 py-4 font-medium", children: "Fee" }), _jsx("th", { className: "px-6 py-4 font-medium", children: "Bank Details" }), _jsx("th", { className: "px-6 py-4 font-medium", children: "Status" }), _jsx("th", { className: "px-6 py-4 font-medium", children: "Date" })] }) }), _jsx("tbody", { className: "divide-y divide-gray-100", children: isLoading ? (_jsx("tr", { children: _jsx("td", { colSpan: 7, className: "p-12 text-center text-gray-400", children: "Loading payouts..." }) })) : !withdrawals?.length ? (_jsx("tr", { children: _jsx("td", { colSpan: 7, className: "p-12 text-center text-gray-400", children: "No withdrawal requests found." }) })) : (withdrawals.map((w) => (_jsxs("tr", { className: "hover:bg-gray-50 group", children: [_jsx("td", { className: "px-6 py-4 font-mono text-xs text-gray-500", children: w.referenceCode }), _jsx("td", { className: "px-6 py-4 font-medium text-gray-900", children: _jsxs("div", { className: "flex flex-col", children: [_jsx("span", { children: w.store?.name || "Unknown" }), _jsx("span", { className: "text-[10px] text-gray-400", children: w.store?.slug })] }) }), _jsx("td", { className: "px-6 py-4 font-bold text-gray-900", children: formatCurrency(w.amountNetKobo) }), _jsxs("td", { className: "px-6 py-4 text-gray-500 text-xs", children: [formatCurrency(w.feeKobo), _jsxs("span", { className: "block text-[10px] text-gray-400", children: ["(", w.feePercent, "%)"] })] }), _jsxs("td", { className: "px-6 py-4", children: [w.bankDetails ? (_jsxs("div", { className: "flex flex-col text-xs", children: [_jsx("span", { className: "font-bold text-gray-900", children: w.bankDetails.bankName }), _jsx("span", { className: "font-mono text-gray-600", children: w.bankDetails.accountNumber }), _jsx("span", { className: "text-gray-400 truncate max-w-[150px]", title: w.bankDetails.accountName, children: w.bankDetails.accountName })] })) : (_jsxs("div", { className: "flex items-center gap-1 text-red-600 bg-red-50 px-2 py-1 rounded w-fit", children: [_jsx(AlertTriangle, { size: 14 }), _jsx("span", { className: "text-xs font-bold", children: "MISSING BENEFICIARY" })] })), !w.hasWalletPin && (_jsxs("div", { className: "mt-1 flex items-center gap-1 text-amber-600", children: [_jsx(AlertTriangle, { size: 10 }), _jsx("span", { className: "text-[10px]", children: "No Security PIN" })] }))] }), _jsx("td", { className: "px-6 py-4", children: getStatusBadge(w.status) }), _jsx("td", { className: "px-6 py-4 text-gray-500 text-xs", children: new Date(w.createdAt).toLocaleDateString() })] }, w.id)))) })] }) })] }));
}
