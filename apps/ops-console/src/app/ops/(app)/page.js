"use client";
import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import { useOpsQuery } from "@/hooks/useOpsQuery";
import { Users, DollarSign, AlertCircle, ArrowRight, Activity } from "lucide-react";
import Link from "next/link";
import { cn } from "@vayva/ui";
// import { formatCurrency } from "@/lib/utils"; 
const formatCurrency = (amount) => {
    return new Intl.NumberFormat("en-NG", {
        style: "currency",
        currency: "NGN",
        minimumFractionDigits: 0,
    }).format(amount);
};
function GatewayHealthCard() {
    const { data: health, isLoading } = useOpsQuery(["gateway-health"], () => fetch("/api/ops/health/ping").then(res => res.json()));
    const isHealthy = health?.checks?.whatsapp_gateway === "UP";
    return (_jsxs("div", { className: cn("p-6 rounded-2xl border border-gray-100 shadow-sm transition-all", isLoading ? "bg-gray-50 animate-pulse" : isHealthy ? "bg-green-50/30" : "bg-red-50"), children: [_jsxs("div", { className: "flex items-start justify-between mb-4", children: [_jsx("div", { className: cn("p-2 rounded-lg", isHealthy ? "bg-green-100 text-green-700" : "bg-red-100 text-red-700"), children: _jsx(Activity, { className: "h-5 w-5" }) }), !isLoading && (_jsx("span", { className: cn("text-[10px] font-black uppercase tracking-widest px-2 py-1 rounded-full", isHealthy ? "bg-green-100 text-green-700" : "bg-red-100 text-red-700"), children: isHealthy ? "Operational" : "Degraded" }))] }), _jsx("div", { className: "text-2xl font-black text-gray-900 mb-1", children: isLoading ? "..." : isHealthy ? "99.9% Up" : "Gateway Down" }), _jsx("div", { className: "text-sm text-gray-500 font-medium", children: "WhatsApp Infrastructure" })] }));
}
function MetricCard({ title, value, icon: Icon, trend, trendUp, color = "bg-white" }) {
    return (_jsxs("div", { className: `${color} p-6 rounded-2xl border border-gray-100 shadow-sm`, children: [_jsxs("div", { className: "flex items-start justify-between mb-4", children: [_jsx("div", { className: "p-2 bg-white/50 rounded-lg", children: _jsx(Icon, { className: "h-5 w-5 text-gray-700" }) }), trend && (_jsx("span", { className: `text-xs font-medium px-2 py-1 rounded-full ${trendUp ? "bg-green-100 text-green-700" : "bg-red-100 text-red-700"}`, children: trend }))] }), _jsx("div", { className: "text-3xl font-bold text-gray-900 mb-1", children: value }), _jsx("div", { className: "text-sm text-gray-500 font-medium", children: title })] }));
}
export default function OpsDashboardPage() {
    const { data, isLoading: loading } = useOpsQuery(["dashboard-stats"], () => fetch("/api/ops/dashboard/stats").then(res => res.json()));
    // Skeleton loader
    if (loading) {
        return (_jsxs("div", { className: "p-8 max-w-7xl mx-auto space-y-8 animate-pulse", children: [_jsx("div", { className: "h-8 w-48 bg-gray-200 rounded-lg" }), _jsx("div", { className: "grid grid-cols-1 md:grid-cols-4 gap-6", children: [1, 2, 3, 4].map(i => (_jsx("div", { className: "h-40 bg-gray-100 rounded-2xl" }, i))) })] }));
    }
    const { merchants, revenue, operations } = data || {};
    return (_jsxs("div", { className: "p-8 max-w-7xl mx-auto space-y-8", children: [_jsxs("div", { children: [_jsx("h1", { className: "text-2xl font-bold text-gray-900", children: "Overview" }), _jsx("p", { className: "text-gray-500 text-sm mt-1", children: "Platform performance and operational alerts." })] }), _jsxs("div", { className: "grid grid-cols-1 md:grid-cols-4 gap-6", children: [_jsx(MetricCard, { title: "Total Revenue", value: revenue ? `₦${(revenue.total).toLocaleString()}` : "₦0", icon: DollarSign, trend: "+12% vs last month", trendUp: true, color: "bg-gradient-to-br from-green-50 to-emerald-50" }), _jsx(MetricCard, { title: "Active Merchants", value: merchants?.total || 0, icon: Users, trend: merchants?.delta, trendUp: true }), _jsx(MetricCard, { title: "Open Tickets", value: operations?.tickets || 0, icon: AlertCircle, color: "bg-orange-50" }), _jsx(GatewayHealthCard, {})] }), _jsxs("div", { className: "grid md:grid-cols-3 gap-8", children: [_jsxs("div", { className: "md:col-span-2 bg-white rounded-2xl border border-gray-200 p-6 h-fit", children: [_jsxs("div", { className: "flex items-center justify-between mb-6", children: [_jsxs("h3", { className: "font-bold text-gray-900 flex items-center gap-2", children: [_jsx(Activity, { className: "h-5 w-5 text-indigo-600" }), "Recent Activity"] }), _jsx(Link, { href: "/ops/admin/audit", className: "text-xs font-semibold text-indigo-600 hover:underline", children: "View Audit Log" })] }), _jsx("div", { className: "space-y-6", children: data?.recentActivity?.length > 0 ? (data.recentActivity.map((activity, i) => (_jsxs("div", { className: "flex gap-4 items-start", children: [_jsx("div", { className: "h-2 w-2 mt-2 rounded-full bg-indigo-400 shrink-0" }), _jsxs("div", { children: [_jsx("p", { className: "text-sm text-gray-900 font-medium", children: activity.message }), _jsx("p", { className: "text-xs text-gray-500", children: activity.timestamp })] })] }, i)))) : (_jsx("div", { className: "text-center py-8 text-gray-500", children: _jsx("p", { className: "text-sm", children: "No recent activity" }) })) })] }), _jsxs("div", { className: "space-y-4", children: [_jsx(Link, { href: "/ops/merchants", className: "block p-4 bg-white border border-gray-200 rounded-xl hover:border-indigo-300 transition-colors group", children: _jsxs("div", { className: "flex justify-between items-center", children: [_jsx("span", { className: "font-medium text-gray-700 group-hover:text-indigo-700", children: "Manage Merchants" }), _jsx(ArrowRight, { className: "h-4 w-4 text-gray-400 group-hover:text-indigo-500" })] }) }), _jsx(Link, { href: "/ops/rescue", className: "block p-4 bg-indigo-50 border border-indigo-100 rounded-xl hover:bg-indigo-100 transition-colors group", children: _jsxs("div", { className: "flex justify-between items-center", children: [_jsx("span", { className: "font-medium text-indigo-900", children: "Rescue Dashboard" }), _jsx(ArrowRight, { className: "h-4 w-4 text-indigo-400 group-hover:text-indigo-600" })] }) })] })] }), _jsxs("div", { children: [_jsx("h3", { className: "font-bold text-gray-900 text-sm uppercase tracking-wider mb-4", children: "Platform Modules" }), _jsxs("div", { className: "grid grid-cols-2 md:grid-cols-4 gap-4", children: [_jsxs(Link, { href: "/ops/admin/team", className: "block p-4 bg-white border border-gray-200 rounded-xl hover:border-purple-300 transition-colors group", children: [_jsx("div", { className: "font-medium text-gray-700 group-hover:text-purple-700 mb-2", children: "Team Access" }), _jsx("div", { className: "text-xs text-gray-500", children: "Invite & manage admins" })] }), _jsxs(Link, { href: "/ops/financials/subscriptions", className: "block p-4 bg-white border border-gray-200 rounded-xl hover:border-emerald-300 transition-colors group", children: [_jsx("div", { className: "font-medium text-gray-700 group-hover:text-emerald-700 mb-2", children: "Billing" }), _jsx("div", { className: "text-xs text-gray-500", children: "SaaS Revenue Monitor" })] }), _jsxs(Link, { href: "/ops/growth/campaigns", className: "block p-4 bg-white border border-gray-200 rounded-xl hover:border-orange-300 transition-colors group", children: [_jsx("div", { className: "font-medium text-gray-700 group-hover:text-orange-700 mb-2", children: "Campaigns" }), _jsx("div", { className: "text-xs text-gray-500", children: "Flash Sales Tracker" })] }), _jsxs(Link, { href: "/ops/partners", className: "block p-4 bg-white border border-gray-200 rounded-xl hover:border-blue-300 transition-colors group", children: [_jsx("div", { className: "font-medium text-gray-700 group-hover:text-blue-700 mb-2", children: "Partners" }), _jsx("div", { className: "text-xs text-gray-500", children: "Affiliate network" })] })] })] })] }));
}
