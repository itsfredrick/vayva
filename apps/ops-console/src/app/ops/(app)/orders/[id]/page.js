"use client";
import { jsx as _jsx, jsxs as _jsxs, Fragment as _Fragment } from "react/jsx-runtime";
import { useEffect, useState } from "react";
import { useParams, useRouter } from "next/navigation";
import Link from "next/link";
import { ArrowLeft, Box, User, CreditCard, Truck, History, MapPin } from "lucide-react";
import { Button } from "@vayva/ui";
export default function OrderDetailPage() {
    const { id } = useParams();
    const router = useRouter();
    const [order, setOrder] = useState(null);
    const [loading, setLoading] = useState(true);
    const [error, setError] = useState("");
    useEffect(() => {
        fetchOrder();
    }, [id]);
    const fetchOrder = async () => {
        try {
            const res = await fetch(`/api/ops/orders/${id}`);
            if (res.status === 401) {
                window.location.href = "/ops/login";
                return;
            }
            if (!res.ok)
                throw new Error("Failed to load order");
            const json = await res.json();
            setOrder(json.data);
        }
        catch (err) {
            setError(err.message);
        }
        finally {
            setLoading(false);
        }
    };
    if (loading) {
        return (_jsx("div", { className: "flex h-screen items-center justify-center", children: _jsx("div", { className: "animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-indigo-600" }) }));
    }
    if (error || !order) {
        return (_jsxs("div", { className: "p-8", children: [_jsxs("div", { className: "bg-red-50 text-red-700 p-4 rounded-lg", children: ["Error: ", error || "Order not found"] }), _jsx(Button, { onClick: () => router.back(), variant: "link", className: "mt-4 text-indigo-600 hover:underline p-0 h-auto", children: "Go Back" })] }));
    }
    return (_jsxs("div", { className: "p-8 space-y-6 max-w-7xl mx-auto", children: [_jsxs("div", { className: "flex items-center gap-4", children: [_jsx(Button, { onClick: () => router.back(), variant: "ghost", size: "icon", className: "h-10 w-10 hover:bg-gray-100 rounded-lg transition-colors p-2", children: _jsx(ArrowLeft, { size: 20, className: "text-gray-600" }) }), _jsxs("div", { children: [_jsxs("div", { className: "flex items-center gap-3", children: [_jsxs("h1", { className: "text-2xl font-bold text-gray-900", children: ["Order #", order.orderNumber] }), _jsx("span", { className: `px-2.5 py-0.5 rounded-full text-xs font-medium border ${order.status === 'PAID' ? 'bg-green-50 text-green-700 border-green-200' :
                                            order.status === 'CANCELLED' ? 'bg-red-50 text-red-700 border-red-200' :
                                                'bg-gray-50 text-gray-700 border-gray-200'}`, children: order.status })] }), _jsxs("p", { className: "text-sm text-gray-500 mt-1", children: ["Placed on ", new Date(order.createdAt).toLocaleString(), " via ", order.store?.name] })] }), _jsx("div", { className: "ml-auto flex gap-2", children: _jsx(Link, { href: `/ops/merchants/${order.storeId}?tab=orders&orderId=${order.id}`, className: "px-4 py-2 text-sm font-medium text-indigo-600 bg-indigo-50 rounded-lg hover:bg-indigo-100", children: "View in Merchant Context" }) })] }), _jsxs("div", { className: "grid grid-cols-1 lg:grid-cols-3 gap-6", children: [_jsxs("div", { className: "lg:col-span-2 space-y-6", children: [_jsxs("div", { className: "bg-white rounded-xl border border-gray-200 overflow-hidden", children: [_jsxs("div", { className: "px-6 py-4 border-b border-gray-200 flex items-center justify-between bg-gray-50", children: [_jsxs("h3", { className: "font-semibold text-gray-900 flex items-center gap-2", children: [_jsx(Box, { size: 18 }), "Order Items"] }), _jsxs("span", { className: "text-sm text-gray-500", children: [order.items?.length || 0, " items"] })] }), _jsx("div", { className: "divide-y divide-gray-100", children: order.items?.map((item) => (_jsxs("div", { className: "px-6 py-4 flex justify-between items-center hover:bg-gray-50", children: [_jsxs("div", { className: "flex items-center gap-4", children: [_jsx("div", { className: "h-10 w-10 bg-gray-100 rounded-lg flex items-center justify-center text-gray-400", children: _jsx(Box, { size: 20 }) }), _jsxs("div", { children: [_jsx("p", { className: "font-medium text-gray-900", children: item.title }), _jsxs("p", { className: "text-sm text-gray-500", children: ["Qty: ", item.quantity] })] })] }), _jsxs("p", { className: "font-medium text-gray-900", children: ["\u20A6", Number(item.price).toLocaleString()] })] }, item.id))) }), _jsx("div", { className: "px-6 py-4 bg-gray-50 border-t border-gray-200 flex justify-end", children: _jsxs("div", { className: "text-right", children: [_jsx("p", { className: "text-sm text-gray-500", children: "Total" }), _jsxs("p", { className: "text-xl font-bold text-gray-900", children: ["\u20A6", Number(order.total).toLocaleString()] })] }) })] }), _jsxs("div", { className: "bg-white rounded-xl border border-gray-200 overflow-hidden", children: [_jsx("div", { className: "px-6 py-4 border-b border-gray-200 bg-gray-50", children: _jsxs("h3", { className: "font-semibold text-gray-900 flex items-center gap-2", children: [_jsx(History, { size: 18 }), "Timeline"] }) }), _jsx("div", { className: "p-6", children: _jsxs("ul", { className: "space-y-6 border-l-2 border-gray-100 ml-3 pl-6 relative", children: [order.OrderEvent?.map((evt, idx) => (_jsxs("li", { className: "relative", children: [_jsx("div", { className: "absolute -left-[2.15rem] mt-1.5 h-3 w-3 rounded-full bg-gray-300 ring-4 ring-white" }), _jsx("p", { className: "text-sm font-medium text-gray-900", children: evt.event }), _jsx("p", { className: "text-xs text-gray-500 mt-0.5", children: new Date(evt.createdAt).toLocaleString() })] }, idx))), _jsxs("li", { className: "relative", children: [_jsx("div", { className: "absolute -left-[2.15rem] mt-1.5 h-3 w-3 rounded-full bg-indigo-500 ring-4 ring-white" }), _jsx("p", { className: "text-sm font-medium text-gray-900", children: "Order Created" }), _jsx("p", { className: "text-xs text-gray-500 mt-0.5", children: new Date(order.createdAt).toLocaleString() })] })] }) })] })] }), _jsxs("div", { className: "space-y-6", children: [_jsxs("div", { className: "bg-white rounded-xl border border-gray-200 p-6", children: [_jsxs("h3", { className: "font-semibold text-gray-900 mb-4 flex items-center gap-2", children: [_jsx(User, { size: 18 }), " Customer"] }), order.Customer ? (_jsxs("div", { className: "space-y-2", children: [_jsxs("p", { className: "font-medium", children: [order.Customer.firstName, " ", order.Customer.lastName] }), _jsx("p", { className: "text-sm text-gray-500", children: order.Customer.email }), _jsx("p", { className: "text-sm text-gray-500", children: order.Customer.phone })] })) : (_jsx("p", { className: "text-sm text-gray-400 italic", children: "No customer linked" })), _jsxs("div", { className: "mt-4 pt-4 border-t border-gray-100", children: [_jsx("h4", { className: "text-xs font-semibold text-gray-500 uppercase", children: "Input Details" }), _jsx("p", { className: "text-sm mt-1", children: order.customerEmail || "N/A" }), _jsx("p", { className: "text-sm", children: order.customerPhone || "N/A" })] })] }), _jsxs("div", { className: "bg-white rounded-xl border border-gray-200 p-6", children: [_jsxs("h3", { className: "font-semibold text-gray-900 mb-4 flex items-center gap-2", children: [_jsx(CreditCard, { size: 18 }), " Payment"] }), _jsxs("div", { className: "space-y-3", children: [_jsxs("div", { className: "flex justify-between text-sm", children: [_jsx("span", { className: "text-gray-500", children: "Status" }), _jsx("span", { className: `font-medium ${order.paymentStatus === 'SUCCESS' ? 'text-green-600' : 'text-amber-600'}`, children: order.paymentStatus })] }), _jsxs("div", { className: "flex justify-between text-sm", children: [_jsx("span", { className: "text-gray-500", children: "Method" }), _jsx("span", { className: "font-medium text-gray-900 capitalize", children: order.paymentMethod?.replace('_', ' ') })] }), order.PaymentTransaction?.[0] && (_jsxs("div", { className: "pt-3 border-t border-gray-100", children: [_jsx("p", { className: "text-xs text-gray-400", children: "Transaction Ref" }), _jsx("p", { className: "text-xs font-mono bg-gray-100 px-2 py-1 rounded mt-1 truncate", children: order.PaymentTransaction[0].reference })] }))] })] }), _jsxs("div", { className: "bg-white rounded-xl border border-gray-200 p-6", children: [_jsxs("h3", { className: "font-semibold text-gray-900 mb-4 flex items-center gap-2", children: [_jsx(Truck, { size: 18 }), " Delivery"] }), _jsxs("div", { className: "space-y-3", children: [_jsxs("div", { className: "flex justify-between text-sm", children: [_jsx("span", { className: "text-gray-500", children: "Status" }), _jsx("span", { className: "font-medium text-gray-900", children: order.fulfillmentStatus })] }), order.Shipment && order.Shipment[0] && (_jsxs(_Fragment, { children: [_jsxs("div", { className: "pt-3 border-t border-gray-100", children: [_jsx("p", { className: "text-xs text-gray-400 mb-1", children: "Shipping Address" }), _jsxs("div", { className: "flex gap-2 text-sm text-gray-600", children: [_jsx(MapPin, { size: 16, className: "shrink-0 mt-0.5" }), _jsxs("div", { children: [_jsx("p", { children: order.Shipment[0].addressLine1 }), _jsx("p", { children: order.Shipment[0].addressCity })] })] })] }), _jsx("div", { className: "pt-3", children: _jsx(Link, { href: `/ops/deliveries/${order.Shipment[0].id}`, className: "text-indigo-600 text-sm hover:underline", children: "View Shipment" }) })] }))] })] })] })] })] }));
}
