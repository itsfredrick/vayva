"use client";
import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import { useOpsQuery } from "@/hooks/useOpsQuery";
import { BrainCircuit, Cpu, Coins, Image, MessageSquare, TrendingUp, Store } from "lucide-react";
const formatCurrency = (amount) => {
    return new Intl.NumberFormat("en-NG", {
        style: "currency",
        currency: "NGN",
        minimumFractionDigits: 0,
    }).format(amount);
};
export default function AiDashboardPage() {
    const { data: stats, isLoading: loading } = useOpsQuery(["ai-stats"], () => fetch("/api/ops/ai/stats").then(res => res.json()));
    if (loading) {
        return (_jsxs("div", { className: "p-8 max-w-7xl mx-auto space-y-8 animate-pulse", children: [_jsx("div", { className: "h-8 w-64 bg-gray-200 rounded-lg" }), _jsx("div", { className: "grid grid-cols-1 md:grid-cols-4 gap-6", children: [1, 2, 3, 4].map(i => _jsx("div", { className: "h-32 bg-gray-100 rounded-xl" }, i)) })] }));
    }
    const { totals, topConsumers } = stats || {};
    return (_jsxs("div", { className: "p-8 max-w-7xl mx-auto space-y-8", children: [_jsxs("div", { className: "flex items-center gap-3 mb-6", children: [_jsx("div", { className: "p-3 bg-purple-100 rounded-xl", children: _jsx(BrainCircuit, { className: "h-6 w-6 text-purple-700" }) }), _jsxs("div", { children: [_jsx("h1", { className: "text-2xl font-bold text-gray-900", children: "AI Intelligence Center" }), _jsx("p", { className: "text-sm text-gray-500", children: "Monitor token consumption, costs, and agent performance." })] })] }), _jsxs("div", { className: "grid grid-cols-1 md:grid-cols-4 gap-6", children: [_jsx(StatCard, { label: "Total Tokens Consumed", value: totals?.tokens?.toLocaleString() || "0", icon: Cpu, color: "bg-blue-50 text-blue-700" }), _jsx(StatCard, { label: "Estimated Cost (All Time)", value: formatCurrency((totals?.costKobo || 0) / 100), icon: Coins, color: "bg-green-50 text-green-700" }), _jsx(StatCard, { label: "Total Requests", value: totals?.requests?.toLocaleString() || "0", icon: MessageSquare, color: "bg-indigo-50 text-indigo-700" }), _jsx(StatCard, { label: "Images Generated", value: totals?.images?.toLocaleString() || "0", icon: Image, color: "bg-pink-50 text-pink-700" })] }), _jsxs("div", { className: "grid grid-cols-1 lg:grid-cols-3 gap-8", children: [_jsxs("div", { className: "lg:col-span-2 bg-white border border-gray-200 rounded-xl overflow-hidden shadow-sm", children: [_jsxs("div", { className: "px-6 py-4 border-b border-gray-100 flex justify-between items-center bg-gray-50/50", children: [_jsxs("h3", { className: "font-bold text-gray-900 flex items-center gap-2", children: [_jsx(Store, { className: "h-4 w-4 text-gray-500" }), "Top Token Consumers"] }), _jsx("span", { className: "text-xs font-semibold text-gray-500 uppercase tracking-wider", children: "All Time" })] }), _jsx("div", { className: "overflow-x-auto", children: _jsxs("table", { className: "w-full text-left text-sm", children: [_jsx("thead", { children: _jsxs("tr", { className: "bg-gray-50 text-gray-500 border-b border-gray-100", children: [_jsx("th", { className: "px-6 py-3 font-medium", children: "Merchant" }), _jsx("th", { className: "px-6 py-3 font-medium", children: "Requests" }), _jsx("th", { className: "px-6 py-3 font-medium", children: "Tokens" }), _jsx("th", { className: "px-6 py-3 font-medium text-right", children: "Cost" })] }) }), _jsxs("tbody", { className: "divide-y divide-gray-100", children: [topConsumers?.length === 0 && (_jsx("tr", { children: _jsx("td", { colSpan: 4, className: "px-6 py-8 text-center text-gray-400", children: "No usage data recorded yet." }) })), topConsumers?.map((merchant) => (_jsxs("tr", { className: "hover:bg-gray-50 transition-colors", children: [_jsx("td", { className: "px-6 py-4", children: _jsxs("div", { className: "flex items-center gap-3", children: [_jsx("div", { className: "h-8 w-8 rounded bg-gray-200 flex items-center justify-center text-xs font-bold text-gray-500", children: merchant.logoUrl ? (_jsx("img", { src: merchant.logoUrl, className: "h-full w-full object-cover rounded" })) : (merchant.name[0]) }), _jsxs("div", { children: [_jsx("div", { className: "font-medium text-gray-900", children: merchant.name }), _jsx("div", { className: "text-xs text-gray-400", children: merchant.slug })] })] }) }), _jsx("td", { className: "px-6 py-4 text-gray-600", children: merchant.totalRequests.toLocaleString() }), _jsx("td", { className: "px-6 py-4 font-mono text-xs text-blue-600 bg-blue-50 rounded px-2 w-fit", children: merchant.totalTokens.toLocaleString() }), _jsx("td", { className: "px-6 py-4 font-medium text-right text-gray-900", children: formatCurrency(merchant.totalCostKobo / 100) })] }, merchant.storeId)))] })] }) })] }), _jsxs("div", { className: "bg-purple-50 border border-purple-100 rounded-xl p-6", children: [_jsxs("h3", { className: "font-bold text-purple-900 mb-2 flex items-center gap-2", children: [_jsx(TrendingUp, { className: "h-5 w-5" }), "AI Cost Insights"] }), _jsx("p", { className: "text-sm text-purple-800 mb-4", children: "Platform usage is billed based on token consumption (Input vs Output) and image generation counts." }), _jsxs("div", { className: "space-y-3", children: [_jsxs("div", { className: "flex justify-between text-sm", children: [_jsx("span", { className: "text-purple-700", children: "Cost per 1K Tokens" }), _jsx("span", { className: "font-medium text-purple-900", children: "\u20A625.00" })] }), _jsxs("div", { className: "flex justify-between text-sm", children: [_jsx("span", { className: "text-purple-700", children: "Image Generation" }), _jsx("span", { className: "font-medium text-purple-900", children: "\u20A645.00 / img" })] }), _jsx("div", { className: "h-px bg-purple-200 my-2" }), _jsx("div", { className: "text-xs text-purple-600 mt-2", children: "* Pricing is estimated based on provider rates (OpenAI/Anthropic) plus margin." })] })] })] })] }));
}
function StatCard({ label, value, icon: Icon, color }) {
    return (_jsxs("div", { className: "bg-white p-6 rounded-xl border border-gray-100 shadow-sm flex items-start gap-4", children: [_jsx("div", { className: `p-3 rounded-lg ${color}`, children: _jsx(Icon, { size: 24 }) }), _jsxs("div", { children: [_jsx("div", { className: "text-2xl font-bold text-gray-900", children: value }), _jsx("div", { className: "text-sm text-gray-500 font-medium", children: label })] })] }));
}
