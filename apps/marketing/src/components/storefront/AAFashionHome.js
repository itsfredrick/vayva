"use client";
import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import { useState } from "react";
import { useStorefrontProducts, useStorefrontStore, } from "@/hooks/storefront/useStorefront";
import { useStorefrontCart } from "@/hooks/storefront/useStorefrontCart";
import { CheckoutModal } from "./CheckoutModal";
import { CountdownTimer } from "./features/CountdownTimer";
import { ShoppingBag, X, Plus, Minus } from "lucide-react";
import { Button } from "@vayva/ui";
export function AAFashionHome({ storeName: initialStoreName, storeSlug, heroText, heroSubtext, showTimer = false, timerDate, heroVideo = "https://cdn.coverr.co/videos/coverr-fashion-photoshoot-with-a-model-5343/1080p.mp4", }) {
    const { store } = useStorefrontStore(storeSlug);
    const { products, isLoading } = useStorefrontProducts(storeSlug, {
        limit: 12,
    });
    // Cart Integration
    const { cart, addToCart, removeFromCart, updateQuantity, total, isOpen: isCartOpen, setIsOpen: setIsCartOpen, clearCart, } = useStorefrontCart(storeSlug || "");
    const [isCheckoutOpen, setIsCheckoutOpen] = useState(false);
    const displayName = store?.name || initialStoreName || "Fashion Store";
    const mainHeadline = heroText || "DARK\nMATTER";
    const subHeadline = heroSubtext || "Season 04 / 24";
    const [raffleItem, setRaffleItem] = useState(null);
    const handleRaffleEntry = async (data) => {
        // Data contains { customer: { ... } }
        await fetch(`/api/storefront/${storeSlug}/raffles/enter`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                raffleId: raffleItem.id, // The product ID acting as raffle ID
                customerEmail: data.customer.email,
                metadata: {
                    name: data.customer.name,
                    phone: data.customer.phone
                }
            })
        });
        setRaffleItem(null);
    };
    const isRaffleMode = !!raffleItem;
    return (_jsxs("div", { className: "bg-black text-white min-h-screen font-sans selection:bg-white selection:text-black", children: [_jsx(CheckoutModal, { isOpen: isCheckoutOpen || !!raffleItem, onClose: () => {
                    setIsCheckoutOpen(false);
                    setRaffleItem(null);
                }, cart: raffleItem ? [raffleItem] : cart, total: raffleItem ? 0 : total, storeSlug: storeSlug || "", onSuccess: clearCart, requireAddress: !isRaffleMode, submitFn: isRaffleMode ? handleRaffleEntry : undefined }), _jsxs("nav", { className: "fixed w-full z-50 mix-blend-difference px-8 py-6 flex justify-between items-center backdrop-blur-sm bg-black/10", children: [_jsx("div", { className: "text-2xl font-bold tracking-tighter uppercase", children: displayName }), _jsxs("div", { className: "flex gap-8 text-sm font-medium tracking-wide items-center", children: [_jsx(Button, { variant: "link", className: "hidden md:block hover:underline underline-offset-4 text-white h-auto", "aria-label": "View collection", children: "Collection" }), _jsx(Button, { variant: "link", className: "hidden md:block hover:underline underline-offset-4 text-white h-auto", "aria-label": "View editorial", children: "Editorial" }), _jsxs(Button, { variant: "link", className: "hover:underline underline-offset-4 flex items-center gap-2 text-white h-auto", onClick: () => setIsCartOpen(true), "aria-label": `View cart with ${cart.length} items`, children: [_jsx(ShoppingBag, { className: "w-5 h-5" }), _jsx("span", { className: "hidden md:inline", children: "Cart" }), _jsx("span", { className: "bg-white text-black text-xs px-2 py-0.5 rounded-full font-bold", children: cart.length })] })] })] }), isCartOpen && (_jsxs("div", { className: "fixed inset-0 z-[60] flex justify-end", children: [_jsx("div", { className: "absolute inset-0 bg-black/60 backdrop-blur-sm", onClick: () => setIsCartOpen(false) }), _jsxs("div", { className: "relative w-full max-w-md bg-[#111] border-l border-gray-800 h-full p-6 flex flex-col animate-in slide-in-from-right duration-300", children: [_jsxs("div", { className: "flex justify-between items-center mb-8", children: [_jsx("h2", { className: "text-xl font-bold uppercase tracking-widest", children: "Your Bag" }), _jsx(Button, { variant: "ghost", size: "icon", onClick: () => setIsCartOpen(false), className: "text-white hover:bg-white/10 h-auto", "aria-label": "Close bag", children: _jsx(X, { className: "w-6 h-6" }) })] }), _jsx("div", { className: "flex-1 overflow-auto space-y-8 pr-2 custom-scrollbar", children: cart.length === 0 ? (_jsxs("div", { className: "h-full flex flex-col items-center justify-center text-gray-500 space-y-4", children: [_jsx(ShoppingBag, { className: "w-12 h-12 opacity-20" }), _jsx("p", { children: "Your bag is empty." })] })) : (cart.map((item) => (_jsxs("div", { className: "flex gap-4 group", children: [_jsx("div", { className: "w-20 h-24 bg-gray-900 rounded overflow-hidden flex-shrink-0", children: item.image && (_jsx("img", { src: item.image, alt: item.name, className: "w-full h-full object-cover group-hover:scale-105 transition-transform duration-500" })) }), _jsxs("div", { className: "flex-1", children: [_jsxs("div", { className: "flex justify-between mb-2 items-start", children: [_jsx("h3", { className: "font-medium text-sm leading-tight pr-4", children: item.name }), _jsxs("span", { className: "text-sm font-mono opacity-80", children: ["\u20A6", (item.price * item.quantity).toLocaleString()] })] }), _jsxs("div", { className: "flex items-center justify-between mt-4", children: [_jsxs("div", { className: "flex items-center border border-gray-800 rounded", children: [_jsx(Button, { variant: "ghost", size: "icon", onClick: () => updateQuantity(item.id, -1), className: "h-8 w-8 hover:bg-white hover:text-black transition-colors rounded-none h-auto", "aria-label": "Decrease quantity", children: _jsx(Minus, { className: "w-3 h-3" }) }), _jsx("span", { className: "px-3 text-xs font-mono", children: item.quantity }), _jsx(Button, { variant: "ghost", size: "icon", onClick: () => updateQuantity(item.id, 1), className: "h-8 w-8 hover:bg-white hover:text-black transition-colors rounded-none h-auto", "aria-label": "Increase quantity", children: _jsx(Plus, { className: "w-3 h-3" }) })] }), _jsx(Button, { variant: "link", onClick: () => removeFromCart(item.id), className: "text-xs text-gray-500 hover:text-red-400 transition-colors p-0 h-auto", "aria-label": `Remove ${item.name} from bag`, children: "Remove" })] })] })] }, item.id)))) }), cart.length > 0 && (_jsxs("div", { className: "border-t border-gray-800 pt-6 mt-6", children: [_jsxs("div", { className: "flex justify-between text-lg font-bold mb-6", children: [_jsx("span", { children: "Total" }), _jsxs("span", { className: "font-mono", children: ["\u20A6", total.toLocaleString()] })] }), _jsx(Button, { onClick: () => {
                                            setIsCartOpen(false);
                                            setIsCheckoutOpen(true);
                                        }, className: "w-full bg-white text-black py-6 h-auto font-bold uppercase tracking-widest hover:bg-gray-200 transition-colors rounded-none h-auto", "aria-label": "Proceed to checkout", children: "Checkout" })] }))] })] })), _jsxs("header", { className: "relative h-screen flex items-center justify-center overflow-hidden", children: [_jsxs("div", { className: "absolute inset-0 z-0", children: [_jsx("div", { className: "absolute inset-0 bg-black/50 z-10" }), _jsx("video", { autoPlay: true, loop: true, muted: true, playsInline: true, className: "w-full h-full object-cover opacity-80", src: heroVideo })] }), _jsxs("div", { className: "relative z-20 text-center max-w-5xl mx-auto px-6 animate-in fade-in zoom-in duration-1000", children: [_jsx("p", { className: "text-sm md:text-base mb-6 font-bold tracking-[0.3em] uppercase opacity-80 text-shadow", children: subHeadline }), _jsx("h1", { className: "text-5xl md:text-9xl font-bold tracking-tighter mb-8 leading-[0.9] whitespace-pre-line", children: mainHeadline }), showTimer && (_jsx("div", { className: "mb-12", children: _jsx(CountdownTimer, { targetDate: timerDate }) })), _jsx(Button, { className: "border border-white bg-transparent hover:bg-white hover:text-black px-12 py-6 h-auto text-sm font-bold tracking-[0.2em] uppercase transition-all duration-300 rounded-none h-auto", "aria-label": "View seasonal collection", children: "View Collection" })] })] }), _jsxs("section", { className: "py-32 px-4 md:px-8 max-w-[1800px] mx-auto", children: [_jsxs("div", { className: "flex justify-between items-end mb-16 border-b border-gray-900 pb-8", children: [_jsx("h2", { className: "text-4xl md:text-6xl font-bold tracking-tighter", children: "Latest Drops" }), _jsx("div", { className: "text-right hidden md:block", children: _jsxs("p", { className: "text-gray-400 text-sm tracking-widest uppercase", children: [displayName, " x Collection"] }) })] }), isLoading && products.length === 0 ? (_jsx("div", { className: "flex justify-center py-40", children: _jsx("div", { className: "w-8 h-8 border-2 border-white border-t-transparent rounded-full animate-spin" }) })) : products.length === 0 ? (_jsxs("div", { className: "text-center py-40 border border-gray-900 border-dashed rounded-xl", children: [_jsx("p", { className: "text-gray-500 mb-4", children: "No products dropped yet." }), _jsx(Button, { variant: "link", className: "text-xs uppercase tracking-widest border-b border-gray-500 p-0 h-auto rounded-none text-gray-400 h-auto", "aria-label": "Check back later for products", children: "Check back later" })] })) : (_jsx("div", { className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-x-6 gap-y-16", children: products.map((product) => (_jsxs("div", { className: "group cursor-pointer", children: [_jsxs("div", { className: "aspect-[3/4] bg-gray-900 mb-6 overflow-hidden relative", children: [_jsx("img", { src: product.image ||
                                                `https://via.placeholder.com/600x800/111/444?text=${encodeURIComponent(product.name)}`, alt: product.name, className: "w-full h-full object-cover grayscale group-hover:grayscale-0 transition-all duration-700 ease-out transform group-hover:scale-105" }), _jsx("div", { className: "absolute bottom-0 left-0 w-full p-4 transform translate-y-full group-hover:translate-y-0 transition-transform duration-300", children: product.price > 50000 || product.id.includes('raffle') ? (_jsx(Button, { onClick: (e) => {
                                                    e.stopPropagation();
                                                    setRaffleItem(product);
                                                }, className: "w-full bg-white text-black py-3 h-auto text-xs font-bold uppercase tracking-widest hover:bg-yellow-400 transition-colors rounded-none h-auto", "aria-label": `Enter raffle for ${product.name}`, children: "Enter Raffle \u2014 Free" })) : (_jsxs(Button, { onClick: (e) => {
                                                    e.stopPropagation();
                                                    addToCart(product);
                                                }, className: "w-full bg-white text-black py-3 h-auto text-xs font-bold uppercase tracking-widest hover:bg-gray-200 transition-colors rounded-none h-auto", "aria-label": `Add ${product.name} to bag`, children: ["Add to Bag \u2014 \u20A6", product.price.toLocaleString()] })) }), (product.price > 50000 || product.id.includes('raffle')) && (_jsx("div", { className: "absolute top-2 right-2 bg-yellow-400 text-black text-[10px] font-bold px-2 py-1 uppercase tracking-wider", children: "Raffle Entry" }))] }), _jsxs("div", { className: "flex justify-between items-start", children: [_jsxs("div", { children: [_jsx("h3", { className: "text-lg font-bold uppercase tracking-tight mb-1 group-hover:underline decoration-1 underline-offset-4", children: product.name }), _jsx("p", { className: "text-gray-500 text-xs", children: product.category || "Available Now" })] }), _jsxs("span", { className: "font-mono text-sm opacity-60", children: ["\u20A6", product.price.toLocaleString()] })] })] }, product.id))) }))] }), _jsxs("footer", { className: "py-20 border-t border-gray-900 text-center opacity-50 text-xs tracking-widest uppercase", children: ["\u00A9 ", new Date().getFullYear(), " ", displayName, ". All Rights Reserved."] })] }));
}
