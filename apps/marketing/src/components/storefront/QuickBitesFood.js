"use client";
import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import { useState, useMemo } from "react";
import { useStorefrontProducts, useStorefrontStore, } from "@/hooks/storefront/useStorefront";
import { useStorefrontCart } from "@/hooks/storefront/useStorefrontCart";
import { CheckoutModal } from "./CheckoutModal";
import { ShoppingBag, ChevronRight, Search, Star, Plus, Minus, X, Menu } from "lucide-react";
import { Button } from "@vayva/ui";
export function QuickBitesFood({ storeName: initialStoreName, storeSlug, bannerTitle = "Get 20% off your first order!", bannerCode = "VAYVA20", bannerDiscount = "20%", }) {
    const { store } = useStorefrontStore(storeSlug);
    const { products, isLoading } = useStorefrontProducts(storeSlug, {
        limit: 100,
    });
    // Cart Logic
    const { cart, addToCart, removeFromCart, updateQuantity, total, isOpen: isCartOpen, setIsOpen: setIsCartOpen, clearCart, } = useStorefrontCart(storeSlug || "");
    const [isCheckoutOpen, setIsCheckoutOpen] = useState(false);
    const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);
    // Category Logic
    const [selectedCategory, setSelectedCategory] = useState("All");
    const categories = useMemo(() => {
        const unique = new Set(products.map((p) => p.category || "Popular"));
        return ["All", ...Array.from(unique)];
    }, [products]);
    const filteredProducts = useMemo(() => {
        if (selectedCategory === "All")
            return products;
        return products.filter((p) => p.category === selectedCategory);
    }, [selectedCategory, products]);
    const displayName = store?.name || initialStoreName || "Food Store";
    return (_jsxs("div", { className: "flex h-screen bg-gray-50 font-sans overflow-hidden", children: [_jsx(CheckoutModal, { isOpen: isCheckoutOpen, onClose: () => setIsCheckoutOpen(false), cart: cart, total: total, storeSlug: storeSlug || "", onSuccess: clearCart }), _jsxs("aside", { className: "w-64 bg-white border-r border-gray-100 flex-shrink-0 flex flex-col justify-between p-6 overflow-y-auto hidden md:flex", children: [_jsxs("div", { children: [_jsxs("div", { className: "flex items-center gap-3 mb-10 text-orange-500", children: [_jsx("div", { className: "bg-orange-100 p-2 rounded-xl", children: _jsx(ShoppingBag, { className: "w-6 h-6" }) }), _jsx("span", { className: "font-extrabold text-xl tracking-tight text-black line-clamp-1", children: displayName })] }), _jsxs("nav", { className: "space-y-2", children: [_jsx("div", { className: "text-xs font-bold text-gray-400 uppercase tracking-wider mb-4 px-2", children: "Menu" }), categories.map((cat) => (_jsx(Button, { variant: selectedCategory === cat ? "primary" : "ghost", onClick: () => setSelectedCategory(cat), className: `w-full justify-start px-4 py-3 rounded-xl text-sm font-medium transition-colors h-auto ${selectedCategory === cat ? "bg-orange-500 text-white shadow-lg shadow-orange-200" : "text-gray-500 hover:bg-gray-50 bg-transparent"}`, children: cat }, cat)))] })] }), _jsxs("div", { className: "mt-8 bg-blue-500 rounded-2xl p-6 text-white text-center relative overflow-hidden shadow-lg shadow-blue-200", children: [_jsx("div", { className: "absolute top-0 right-0 p-4 opacity-10", children: _jsx(Star, { className: "w-12 h-12" }) }), _jsxs("div", { className: "relative z-10", children: [_jsx("div", { className: "font-bold text-lg mb-1", children: "Free Delivery" }), _jsx("p", { className: "text-xs text-blue-100 mb-3", children: "On all orders over \u20A65,000" }), _jsx(Button, { className: "text-xs bg-white text-blue-500 px-4 py-2 rounded-lg font-bold hover:bg-blue-50 transition-colors h-auto", children: "Details" })] })] })] }), isMobileMenuOpen && (_jsx("div", { className: "fixed inset-0 z-50 bg-black/50 md:hidden", onClick: () => setIsMobileMenuOpen(false), children: _jsxs("aside", { className: "w-64 bg-white h-full p-6 animate-in slide-in-from-left", onClick: e => e.stopPropagation(), children: [_jsxs("div", { className: "flex justify-between items-center mb-8", children: [_jsx("span", { className: "font-bold text-xl", children: displayName }), _jsx(Button, { variant: "ghost", size: "icon", onClick: () => setIsMobileMenuOpen(false), "aria-label": "Close mobile menu", children: _jsx(X, { className: "w-5 h-5" }) })] }), _jsx("nav", { className: "space-y-2", children: categories.map((cat) => (_jsx(Button, { variant: selectedCategory === cat ? "primary" : "ghost", onClick: () => { setSelectedCategory(cat); setIsMobileMenuOpen(false); }, className: `w-full justify-start px-4 py-3 rounded-xl text-sm font-medium h-auto ${selectedCategory === cat ? "bg-orange-500 text-white" : "text-gray-500 bg-transparent"}`, children: cat }, cat))) })] }) })), _jsxs("main", { className: "flex-1 flex flex-col h-full overflow-hidden relative", children: [_jsxs("header", { className: "h-20 bg-white border-b border-gray-100 flex items-center justify-between px-4 md:px-8 flex-shrink-0", children: [_jsxs("div", { className: "flex items-center gap-4", children: [_jsx(Button, { variant: "ghost", size: "icon", className: "md:hidden p-2 text-gray-500", onClick: () => setIsMobileMenuOpen(true), "aria-label": "Open mobile menu", children: _jsx(Menu, { className: "w-6 h-6" }) }), _jsxs("div", { className: "flex items-center gap-4 bg-gray-100 px-4 py-2 rounded-xl w-full md:w-96 transition-all focus-within:ring-2 focus-within:ring-orange-200 focus-within:bg-white", children: [_jsx(Search, { className: "w-5 h-5 text-gray-400" }), _jsx("input", { type: "text", placeholder: `Search ${displayName}...`, className: "bg-transparent border-none text-sm w-full focus:outline-none placeholder:text-gray-400" })] })] }), _jsxs(Button, { variant: "ghost", size: "icon", className: "md:hidden p-2 bg-orange-100 text-orange-600 rounded-lg relative", onClick: () => setIsCartOpen(true), "aria-label": `View cart with ${cart.length} items`, children: [_jsx(ShoppingBag, { className: "w-5 h-5" }), cart.length > 0 && _jsx("span", { className: "absolute -top-1 -right-1 bg-red-500 text-white w-4 h-4 text-[10px] rounded-full flex items-center justify-center font-bold", children: cart.length })] })] }), _jsxs("div", { className: "flex-1 overflow-y-auto p-4 md:p-8 pb-32 md:pb-8", children: [_jsxs("div", { className: "bg-orange-500 rounded-3xl p-8 mb-10 text-white flex items-center justify-between shadow-xl shadow-orange-200 bg-[url('https://www.transparenttextures.com/patterns/food.png')]", children: [_jsxs("div", { className: "relative z-10", children: [_jsx("h2", { className: "text-2xl md:text-3xl font-bold mb-2", children: bannerTitle }), _jsxs("p", { className: "text-orange-100", children: ["Use code:", " ", _jsx("span", { className: "font-mono bg-white/20 px-2 py-0.5 rounded font-bold tracking-widest border border-white/30", children: bannerCode })] })] }), _jsx("div", { className: "text-4xl md:text-6xl animate-bounce duration-[3000ms]", children: "\uD83C\uDF54" })] }), _jsx("div", { className: "flex items-center justify-between mb-6", children: _jsxs("h2", { className: "text-2xl font-bold text-gray-800", children: [selectedCategory, " Menu"] }) }), isLoading ? (_jsx("div", { className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6", children: [1, 2, 3, 4, 5, 6].map(i => (_jsx("div", { className: "h-64 bg-gray-200 rounded-2xl animate-pulse" }, i))) })) : (_jsx("div", { className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 pb-20", children: filteredProducts.map((p) => (_jsxs("div", { className: "bg-white p-4 rounded-2xl border border-gray-100 hover:shadow-lg transition-all group cursor-pointer hover:-translate-y-1", onClick: () => addToCart(p), children: [_jsxs("div", { className: "aspect-video bg-gray-50 rounded-xl mb-4 overflow-hidden relative", children: [_jsx("img", { src: p.image ||
                                                        `https://via.placeholder.com/300x200?text=${p.name}`, alt: p.name, className: "w-full h-full object-cover group-hover:scale-105 transition-transform duration-500" }), _jsx(Button, { variant: "primary", size: "icon", className: "absolute bottom-2 right-2 bg-white rounded-full p-2 shadow-md opacity-0 translate-y-2 group-hover:opacity-100 group-hover:translate-y-0 transition-all duration-300 hover:bg-orange-500 hover:text-white h-8 w-8", "aria-label": "Add to bag", children: _jsx(Plus, { className: "w-4 h-4" }) })] }), _jsxs("div", { className: "flex justify-between items-start mb-2", children: [_jsx("h3", { className: "font-bold text-gray-900 leading-tight", children: p.name }), _jsxs("span", { className: "font-bold text-orange-500 whitespace-nowrap ml-2", children: ["\u20A6", p.price.toLocaleString()] })] }), _jsx("p", { className: "text-xs text-gray-500 line-clamp-2", children: p.description })] }, p.id))) }))] })] }), _jsxs("aside", { className: `fixed inset-y-0 right-0 w-80 bg-white border-l border-gray-100 shadow-2xl transform transition-transform duration-300 z-50 ${isCartOpen ? "translate-x-0" : "translate-x-full"}`, children: [_jsxs("div", { className: "p-6 border-b border-gray-50 flex items-center justify-between bg-white z-10", children: [_jsx("h3", { className: "font-bold text-lg", children: "My Order" }), _jsxs("div", { className: "flex items-center gap-3", children: [_jsx("div", { className: "text-xs bg-orange-100 text-orange-600 px-2 py-1 rounded font-bold", children: cart.length }), _jsx(Button, { variant: "ghost", size: "icon", onClick: () => setIsCartOpen(false), className: "hover:bg-gray-100 p-1 rounded-full text-gray-500", "aria-label": "Close bag sidebar", children: _jsx(X, { className: "w-5 h-5" }) })] })] }), _jsx("div", { className: "flex-1 overflow-y-auto p-6 space-y-6 h-[calc(100vh-200px)]", children: cart.length === 0 ? (_jsxs("div", { className: "h-full flex flex-col items-center justify-center text-gray-400 space-y-4", children: [_jsx("div", { className: "w-16 h-16 bg-gray-50 rounded-full flex items-center justify-center text-2xl", children: "\uD83E\uDD63" }), _jsx("p", { children: "Your plate is empty" })] })) : (cart.map((item) => (_jsxs("div", { className: "flex gap-4 items-center animate-in slide-in-from-right-2", children: [_jsx("div", { className: "w-12 h-12 bg-gray-100 rounded-lg overflow-hidden flex-shrink-0", children: item.image && (_jsx("img", { src: item.image, alt: item.name, className: "w-full h-full object-cover" })) }), _jsxs("div", { className: "flex-1 min-w-0", children: [_jsx("div", { className: "font-bold text-sm mb-1 truncate", children: item.name }), _jsxs("div", { className: "text-xs text-gray-400", children: ["\u20A6", (item.price * item.quantity).toLocaleString()] })] }), _jsxs("div", { className: "flex items-center gap-2 bg-gray-100 rounded-lg p-1", children: [_jsx(Button, { variant: "ghost", size: "icon", onClick: () => updateQuantity(item.id, -1), className: "p-1 hover:bg-white rounded transition-colors text-gray-600 h-6 w-6", "aria-label": "Decrease quantity", children: _jsx(Minus, { className: "w-3 h-3" }) }), _jsx("span", { className: "text-xs font-bold w-4 text-center", children: item.quantity }), _jsx(Button, { variant: "ghost", size: "icon", onClick: () => updateQuantity(item.id, 1), className: "p-1 hover:bg-white rounded transition-colors text-gray-600 h-6 w-6", "aria-label": "Increase quantity", children: _jsx(Plus, { className: "w-3 h-3" }) })] })] }, item.id)))) }), _jsxs("div", { className: "absolute bottom-0 left-0 right-0 p-6 bg-gray-50 border-t border-gray-100", children: [_jsxs("div", { className: "space-y-2 mb-6", children: [_jsxs("div", { className: "flex justify-between text-sm text-gray-500", children: [_jsx("span", { children: "Subtotal" }), _jsxs("span", { children: ["\u20A6", total.toLocaleString()] })] }), _jsxs("div", { className: "flex justify-between text-lg font-bold text-gray-900 pt-2 border-t border-gray-200", children: [_jsx("span", { children: "Total" }), _jsxs("span", { children: ["\u20A6", total.toLocaleString()] })] })] }), _jsxs(Button, { disabled: cart.length === 0, onClick: () => { setIsCartOpen(false); setIsCheckoutOpen(true); }, className: "w-full bg-orange-500 text-white py-6 h-auto rounded-xl font-bold shadow-lg shadow-orange-200 hover:bg-orange-600 disabled:opacity-50 disabled:shadow-none transition-all flex items-center justify-center gap-2 active:scale-95", children: ["Checkout ", _jsx(ChevronRight, { className: "w-4 h-4" })] })] })] })] }));
}
